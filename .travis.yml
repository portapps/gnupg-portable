os: windows
language: shell

env:
  global:
    - GOVERSION: 1.12.4
    - NODEJS_VERSION: 11.14.0

before_install:
  - git clone https://github.com/portapps/portapps ${TRAVIS_BUILD_DIR}/../portapps
  - source ${TRAVIS_BUILD_DIR}/../portapps/.travis/prepare.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/java.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/ant.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/nodejs.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/go.sh
  - set

script:
  - ant release

after_success:
  - export APP_VERSION=$(cat $TRAVIS_BUILD_DIR/bin/tmp/version.dat)
  - echo ${APP_VERSION}

before_deploy:
  - git config --local user.email "builds@travis-ci.com"
  - git config --local user.name "Travis CI"
  - export TRAVIS_TAG="${APP_VERSION}"
  - git tag $TRAVIS_TAG
  - ls -al bin/release

deploy:
  provider: releases
  api_key:
    secure: Abs4EvqtJmqh5Acp0Ji7jlkioc7BDZ66mhKRZv3ucw6BpZkyivl7CmS3EBIbRf6/lv39I72SbEoXxtjz3T9EcMs/Ct4BHEeblZBOIs3RdIRx+YA5/aLwfMlZIoGr04enxKTZ9FnRCBikFopUsmWQfaug557RCBLYGmuNIko6eK4RkJxUYvkZT6mM7IRR2N3OKHE3oe0mYjVCXKCc/U4m6coz3BHhTsnx8wda6gHJnsvjNyM6T4PRnBIAjUjW14Ula6FSzfHhm1774SQHrUtqnrPaD3sq/CDiRMxO7BrgF7d6/kMFTAqAmA8R71DnKkAUii/qNhRMuqqsqjVexBxJEce+uVuS+aJJwKmTdr8StM1M8Z/PKU569ARF5COEiSG1UHHZDRxnGEE+ZdCfxJOpJ2BUg14iX0CMn255Y4AXx7D115sgnF7CbKEYQ8u/vlVJs0ivUJtwHj+mden6Et1H2Tiu4az1y4pdXR7wPRgTQ36lA3Xj775w9MKfrjtqymerxnKRbmY0X4CEzrXBoyliH0//vDzfGJtgQ3gMl+sn9VR2xv+NjrOWr18OOiV7DAwihY2wkGaYwpApFHwtqvMbM9Y+B7RXZIWgjga3bWVvRMwfzptcHmxQ8Z579WHobN8ZSQvAPmZ/Jzy7PrZMRPZtG2Mv8297+Wgie7veGhJiIog=
  file_glob: true
  file: bin/release/*
  skip_cleanup: true
  draft: true
  on:
    tags: false

notifications:
  email:
    recipients:
      - travisci@portapps.io
    on_success: always
    on_failure: always
